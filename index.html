<!doctype html>
<html><head><script src="enchant/enchant.js"></script></head>
<body style="margin:0; padding: 0; background-color: #888;">
<!--
基本
http://www.atmarkit.co.jp/ait/articles/1304/01/news034_3.html
点滅
http://www.openspc2.org/reibun/enchant.js/v0.4.3/label/0004/index.html
背景スクロール
http://www.atmarkit.co.jp/ait/articles/1306/25/news026_2.html
-->
<script>
    enchant(); // initialize
    // 基本設定
    var game = new Core(320, 240); // game stage // 画面サイズ
    game.scale = 1; // 拡大率
    game.fps = 20;
    
    // リソース準備
    game.preload('img/chara1.png'); // preload image
    game.preload('img/title.png'); // タイトル背景
    game.preload('img/game.png'); // ゲーム背景
    game.preload('img/gameloop.png'); // ゲーム背景ループ 320x50
    game.preload('img/start.png'); // START 236x48
    game.preload('img/fishkun37x24.gif'); // ふぃっしゅくん
    game.preload('img/ground32x32.gif'); // 地面
    game.preload('img/ground320x32.gif'); // 地面（長い版）

    game.onload = function(){
        // タイトルシーン
        var createTitleScene = function(){
            var scene = new Scene();
            
            // タイトル背景画像
            var back = new Sprite(320, 240);
            back.image = game.assets['img/title.png'];
            scene.addChild(back);

            // ラベル
            //var label = new Label('Welcome the enchant.fish world!');
            //scene.addChild(label);

            // スタート画像
            var start = new Sprite(236, 48);
            start.x = (320 - 236) / 2;
            start.y = (240 - 48) / 2;
            start.textAlign = 'center';
            start.image = game.assets['img/start.png'];
            scene.addChild(start);
            
            // スタート画像は点滅させる
            start.addEventListener(Event.ENTER_FRAME, function(){
               start.opacity = (new Date()).getMilliseconds() > 500 ? 1 : 0;
            });
            
            // タッチイベント
            scene.addEventListener(Event.TOUCH_START, function(e){
                // ゲームシーンに切り替え
                game.replaceScene(createGameScene());
            });

            // 作成されたシーンを返す
            return scene;
        };
        
        // ゲームシーン
        var createGameScene = function(){
            var scene = new Scene();
            
            // ゲーム背景画像
            //var back = new Sprite(320, 240);
            //back.image = game.assets['img/game.png'];
            //scene.addChild(back);
            
            // ラベル
            var label = new Label('Go go go!!!');
            scene.addChild(label);
            
            // ゲームループ背景画像
            var loop = new Sprite(320, 50);
            loop.image = game.assets['img/gameloop.png'];
            loop.y = 240 - 32 - 50;
            scene.addChild(loop);
            var loop2 = new Sprite(320, 50);
            loop2.image = game.assets['img/gameloop.png'];
            loop2.x = 320;
            loop2.y = 240 - 32 - 50;
            scene.addChild(loop2);
            
            // 地面
            var ground = new Sprite(320, 32);
            ground.image = game.assets['img/ground320x32.gif'];
            ground.y = 240 - 32;
            scene.addChild(ground);
            var ground2 = new Sprite(320, 32);
            ground2.image = game.assets['img/ground320x32.gif'];
            ground2.x = 320;
            ground2.y = 240 - 32;
            scene.addChild(ground2);

            // 背景スクロール
            scene.addEventListener(Event.ENTER_FRAME, function(){
                // 遠景
                var LOOP_SPEED_DIST = 1;
                loop.x -= LOOP_SPEED_DIST;
                if(loop.x <= -320){
                    loop.x = 320;
                }
                loop2.x -= LOOP_SPEED_DIST;
                if(loop2.x <= -320){
                    loop2.x = 320;
                }
                // 地面
                var LOOP_SPEED = 5;
                ground.x -= LOOP_SPEED;
                if(ground.x <= -320){
                    ground.x = 320;
                }
                ground2.x -= LOOP_SPEED;
                if(ground2.x <= -320){
                    ground2.x = 320;
                }
            });
            scene.backgroundColor = 'rgb(0, 107, 247)';
            
            // キャラ（くま）
            var bear = new Sprite(32, 32); // 1キャラのサイズ
            bear.image = game.assets['img/chara1.png'];
            bear.frame = [6, 6, 7, 7];   // select sprite frame
            bear.tl.moveBy(288, 0, 90)   // move right
                .scaleTo(-1, 1, 10)      // turn left
                .moveBy(-288, 0, 90)     // move left
                .scaleTo(1, 1, 10)       // turn right
                .loop();                 // loop it
            scene.addChild(bear);

            // キャラ（さかな）
            var fish = new Sprite(37, 24); // 1キャラのサイズ
            fish.y = 186;
            fish.image = game.assets['img/fishkun37x24.gif'];
            fish.frame = [0, 1, 2, 3, 4, 5];   // select sprite frame
            fish.tl.moveBy(288, 0, 90)   // move right
                .scaleTo(-1, 1, 10)      // turn left
                .moveBy(-288, 0, 90)     // move left
                .scaleTo(1, 1, 10)       // turn right
                .loop();                 // loop it
            scene.addChild(fish);

            // イベント
            scene.addEventListener(Event.TOUCH_START, function(e){
                // 今のシーンの上に重ねてシーンを乗せる
                game.pushScene(createGameoverScene());
            });
            return scene;
        };
        
        // ゲームオーバーシーン
        var createGameoverScene = function(){
            var scene = new Scene();
            var label = new Label('You died');
            label.x = 0;
            label.y = 20;
            scene.addChild(label);
            scene.backgroundColor = 'rgba(0, 0, 0, 0.5)'; // 半透明な黒
            scene.addEventListener(Event.TOUCH_START, function(e){
                game.popScene();
            });
            return scene;
        };
        
        // 最初のシーン（タイトル）
        //game.replaceScene(createTitleScene());
        game.replaceScene(createGameScene());
    };

    game.start(); // start your game!
</script>
</body>
</html>
